blueprint:
  name: Speaker control
  domain: automation
  input:
    speaker_entity:
      name: Speaker Entity
    button_entity:
      name: Button Entity
mode: restart
trigger:
  - platform: state
    entity_id:
      - !input button_entity
    attribute: action
    not_from: ""
action:
  - choose:
    - conditions: "{{ trigger.to_state.attributes.action == 'play_pause' }}"
      sequence:
        - service: media_player.toggle
          target:
            entity_id: !input speaker_entity
    - conditions: "{{ trigger.to_state.attributes.action == 'skip_forward' }}"
      sequence:
        - choose:
          - conditions: "{{ state_attr('!input speaker_entity', 'source') == 'WCX-50' }}"
            sequence:
              - service: media_player.select_source
                data:
                  source: Echo Dot
                target:
                  entity_id: !input speaker_entity
          - conditions: "{{ state_attr('!input speaker_entity', 'source') == 'Echo Dot' }}"
            sequence:
              - service: media_player.select_source
                data:
                  source: WCX-50
                target:
                  entity_id: !input speaker_entity
    - conditions: "{{ trigger.to_state.attributes.action == 'rotate_right' }}"
      sequence:
        - repeat:
            while: "True"
            sequence:
              - service: media_player.volume_up
                target:
                  entity_id: !input speaker_entity
              - delay:
                  milliseconds: 200
    - conditions: "{{ trigger.to_state.attributes.action == 'rotate_left' }}"
      sequence:
        - repeat:
            while: "True"
            sequence:
              - service: media_player.volume_down
                target:
                  entity_id: !input speaker_entity
              - delay:
                  milliseconds: 200
